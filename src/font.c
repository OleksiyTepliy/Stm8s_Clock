#include "stm8s.h"
#include "font.h"

#define SPACE 10
/* https://github.com/squix78/MAX7219LedMatrix */
/* can be sent without transformations */
static const uint8_t fontArray[][8] = {
	{0x78, 0xCC, 0xDC, 0xFC, 0xEC, 0xCC, 0x78, 0x00}, // 0x30 // 0
	{0x30, 0xF0, 0x30, 0x30, 0x30, 0x30, 0xFC, 0x00}, // 0x31 // 1
	{0x78, 0xCC, 0x0C, 0x38, 0x60, 0xCC, 0xFC, 0x00}, // 0x32 // 2
	{0x78, 0xCC, 0x0C, 0x38, 0x0C, 0xCC, 0x78, 0x00}, // 0x33 // 3
	{0x1C, 0x3C, 0x6C, 0xCC, 0xFE, 0x0C, 0x0C, 0x00}, // 0x34 // 4
	{0xFC, 0xC0, 0xF8, 0x0C, 0x0C, 0xCC, 0x78, 0x00}, // 0x35 // 5
	{0x38, 0x60, 0xC0, 0xF8, 0xCC, 0xCC, 0x78, 0x00}, // 0x36 // 6
	{0xFC, 0xCC, 0x0C, 0x18, 0x30, 0x60, 0x60, 0x00}, // 0x37 // 7
	{0x78, 0xCC, 0xCC, 0x78, 0xCC, 0xCC, 0x78, 0x00}, // 0x38 // 8
	{0x78, 0xCC, 0xCC, 0x7C, 0x0C, 0x18, 0x70, 0x00}, // 0x39 // 9
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, // space
};

static uint8_t symbol[FONT_SYMBOL_SIZE_IN_BYTES] = {0};

const uint8_t * fontGetNumberArray(uint8_t number)
{
	number &= 0x0F;
	return &fontArray[number][0];
}

uint8_t * fontGetNumberArrayShifted(uint8_t number, FontSymbolShift shiftDirection, uint8_t shift)
{
	number &= 0x0F;
	for (uint8_t i = 0; i < FONT_SYMBOL_SIZE_IN_BYTES; i++) {
		switch (shiftDirection) {
		case FONT_SYMBOL_LEFT_SHIFT:
			symbol[i] = fontArray[number][i] << shift;
			break;
		case FONT_SYMBOL_RIGHT_SHIFT:
			symbol[i] = fontArray[number][i] >> shift;
			break;
		default:
			break;
		}
	}
	return symbol;
}

	
uint8_t * fontAddDots(const uint8_t fontSymbol[FONT_SYMBOL_SIZE_IN_BYTES], FontSymbolShift dotsSide)
{
	uint8_t orValue = 0x00;
	switch (dotsSide) {
	case FONT_SYMBOL_LEFT_SHIFT:
		orValue = 0x80;
		break;
	case FONT_SYMBOL_RIGHT_SHIFT:
		orValue = 0x01;
		break;
	default:
		break;
	}
	
	for (uint8_t i = 0; i < FONT_SYMBOL_SIZE_IN_BYTES; i++) {
		if (i == 1 || i == 2 || i == 5 || i == 6)
			symbol[i] = (fontSymbol[i] | orValue);
		else
			symbol[i] = fontSymbol[i];
	}
	return symbol;
}

const uint8_t * fontGetSpaceArray(void)
{
	return &fontArray[SPACE][0]; 
}
